<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Send Gmail — Stealth</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Background Canvas -->
  <canvas id="bgLines"></canvas>

  <!-- Main App -->
  <main id="app" class="app">
    <header class="app-header">
      <h1 class="brand">SEND GMAIL</h1>
      <p class="tag">Stealth Mode • Animated • Responsive</p>
    </header>

    <!-- Gmail Selection -->
    <section class="gmail-section">
      <div class="gmail-row">
        <!-- Generate 10 Gmail buttons -->
        ${[...Array(10)].map((_, i) => `
          <div class="gmail-cell ${i===0?'active':''}" data-index="${i}" title="Gmail ${i+1}">
            <img src="gmail.png" alt="Gmail ${i+1}" class="gmail-img">
            <div class="label">Gmail ${i+1}</div>
          </div>
        `).join('')}
      </div>
    </section>

    <!-- Input Number -->
    <section class="send">
      <input id="target" class="input" type="text" placeholder="Input the target number" aria-label="Target Number"/>
      <div class="controls-row">
        <button id="sendBtn" class="btn">SEND GMAIL</button>
      </div>
    </section>

    <!-- Result -->
    <section class="result-area">
      <div id="successBox" class="result success" style="display:none"></div>
      <div id="failedBox" class="result failed" style="display:none"></div>
    </section>

  </main>

  <script>
  (function(){
    const gmailCells = document.querySelectorAll('.gmail-cell');
    const sendBtn = document.getElementById('sendBtn');
    const targetInput = document.getElementById('target');
    const successBox = document.getElementById('successBox');
    const failedBox = document.getElementById('failedBox');
    let selectedGmailIndex = 0;

    // Gmail selection
    gmailCells.forEach(cell => {
      cell.addEventListener('click', () => {
        gmailCells.forEach(c=>c.classList.remove('active'));
        cell.classList.add('active');
        selectedGmailIndex = Number(cell.dataset.index);
      });
    });

    // Send Gmail
    sendBtn.addEventListener('click', async () => {
      const number = targetInput.value.trim();
      if(!number){ alert("Input the target number first."); return; }

      sendBtn.disabled = true;
      sendBtn.textContent = "Sending...";

      successBox.style.display = 'none';
      failedBox.style.display = 'none';

      try {
        const res = await fetch('/api/send.js', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({
            requesterEmail: localStorage.getItem('userEmail') || 'user1@example.com',
            gmailIndex: selectedGmailIndex,
            number
          })
        });
        const data = await res.json();
        if(res.ok){
          successBox.innerHTML = `<strong>SUCCESS SEND TO TARGET EMAIL</strong><br>
            TIME SEND: ${new Date().toLocaleString()}<br>
            MESSAGE ID: ${data.messageId || 'N/A'}`;
          successBox.style.display = 'block';
        } else {
          failedBox.innerHTML = `<strong>FAILED TO SEND EMAIL</strong><br>${data.message || data.error}`;
          failedBox.style.display = 'block';
        }
      } catch(err){
        failedBox.innerHTML = `<strong>FAILED TO SEND EMAIL</strong><br>Network error`;
        failedBox.style.display = 'block';
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = "SEND GMAIL";
      }
    });

    // Floating animation
    setInterval(() => {
      document.querySelectorAll('.gmail-img').forEach((img, idx) => {
        const t = Date.now()/1000;
        img.style.transform = 'translateY('+(Math.sin(t+idx)*6)+'px) rotate('+(Math.sin(t/1.4+idx)*1.5)+'deg)';
      });
    }, 50);

  })();
  </script>
</body>
</html>
